<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tropic Magic - Admin Dashboard</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    
    <style>
        :root {
            --waiting: #FF6B6B;
            --preparing: #FFD166;
            --ready: #06D6A0;
            --completed: #118AB2;
            --dark: #073B4C;
            --light: #F8F9FA;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        body {
            background: var(--light);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Header */
        .admin-header {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 25px;
            text-align: center;
            border-left: 5px solid #06D6A0;
        }
        
        .admin-title {
            font-size: 2.2rem;
            color: var(--dark);
            margin-bottom: 10px;
        }
        
        .admin-subtitle {
            color: #666;
            font-size: 1.1rem;
        }
        
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-top: 4px solid #06D6A0;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
            font-weight: 600;
        }
        
        /* Kanban Board */
        .kanban-board {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-column {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-height: 500px;
        }
        
        .column-header {
            text-align: center;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
            font-weight: bold;
            color: white;
            font-size: 1.1rem;
        }
        
        .waiting-header { background: var(--waiting); }
        .preparing-header { background: var(--preparing); color: var(--dark); }
        .ready-header { background: var(--ready); }
        .completed-header { background: var(--completed); }
        
        .column-count {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        /* Order Cards */
        .order-card {
            background: var(--light);
            border-radius: 10px;
            padding: 18px;
            margin-bottom: 15px;
            border-left: 4px solid;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        
        .order-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .order-card.waiting { border-left-color: var(--waiting); }
        .order-card.preparing { border-left-color: var(--preparing); }
        .order-card.ready { border-left-color: var(--ready); }
        .order-card.completed { border-left-color: var(--completed); }
        
        .order-id {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--dark);
            margin-bottom: 5px;
        }
        
        .customer-info {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        
        .order-items {
            margin: 10px 0;
            font-size: 0.9rem;
        }
        
        .order-total {
            font-weight: bold;
            color: var(--dark);
            margin: 8px 0;
        }
        
        .order-time {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 12px;
        }
        
        .order-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .status-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 600;
        }
        
        .status-btn:hover {
            transform: scale(1.05);
        }
        
        .btn-waiting { background: var(--waiting); color: white; }
        .btn-preparing { background: var(--preparing); color: var(--dark); }
        .btn-ready { background: var(--ready); color: white; }
        .btn-completed { background: var(--completed); color: white; }
        
        /* Best Sellers */
        .best-sellers {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .best-sellers h3 {
            margin-bottom: 20px;
            color: var(--dark);
            text-align: center;
            font-size: 1.3rem;
        }
        
        .seller-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }
        
        .seller-item:last-child {
            border-bottom: none;
        }
        
        .seller-rank {
            font-weight: bold;
            margin-right: 10px;
            color: var(--dark);
        }
        
        .seller-count {
            background: #06D6A0;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--ready);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="admin-header">
            <h1 class="admin-title">üå¥ Tropic Magic - Command Center</h1>
            <p class="admin-subtitle">Live Order Management Dashboard</p>
        </div>
        
        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalOrders">0</div>
                <div class="stat-label">Total Orders</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="waitingOrders">0</div>
                <div class="stat-label">Waiting</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="preparingOrders">0</div>
                <div class="stat-label">Preparing</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="revenue">‚Çπ0</div>
                <div class="stat-label">Revenue</div>
            </div>
        </div>
        
        <!-- Kanban Board -->
        <div class="kanban-board">
            <!-- Waiting Column -->
            <div class="status-column">
                <div class="column-header waiting-header">
                    üî¥ WAITING
                    <div class="column-count" id="waitingCount">0 orders</div>
                </div>
                <div id="waitingColumn" class="orders-container">
                    <div class="empty-state">
                        <div class="icon">‚è≥</div>
                        <p>No orders waiting</p>
                    </div>
                </div>
            </div>
            
            <!-- Preparing Column -->
            <div class="status-column">
                <div class="column-header preparing-header">
                    üü° PREPARING
                    <div class="column-count" id="preparingCount">0 orders</div>
                </div>
                <div id="preparingColumn" class="orders-container">
                    <div class="empty-state">
                        <div class="icon">üë®‚Äçüç≥</div>
                        <p>No orders preparing</p>
                    </div>
                </div>
            </div>
            
            <!-- Ready Column -->
            <div class="status-column">
                <div class="column-header ready-header">
                    üü¢ READY
                    <div class="column-count" id="readyCount">0 orders</div>
                </div>
                <div id="readyColumn" class="orders-container">
                    <div class="empty-state">
                        <div class="icon">‚úÖ</div>
                        <p>No orders ready</p>
                    </div>
                </div>
            </div>
            
            <!-- Completed Column -->
            <div class="status-column">
                <div class="column-header completed-header">
                    üîµ COMPLETED
                    <div class="column-count" id="completedCount">0 orders</div>
                </div>
                <div id="completedColumn" class="orders-container">
                    <div class="empty-state">
                        <div class="icon">üéâ</div>
                        <p>No orders completed</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Best Sellers -->
        <div class="best-sellers">
            <h3>üî• LIVE BEST SELLERS</h3>
            <div id="bestSellersList">
                <div class="seller-item">
                    <span><span class="seller-rank">1.</span> BTS Mocktail</span>
                    <span class="seller-count">0 orders</span>
                </div>
                <div class="seller-item">
                    <span><span class="seller-rank">2.</span> Blue Lagoon</span>
                    <span class="seller-count">0 orders</span>
                </div>
                <div class="seller-item">
                    <span><span class="seller-rank">3.</span> Veg Sandwich</span>
                    <span class="seller-count">0 orders</span>
                </div>
            </div>
        </div>
        
        <!-- Notification -->
        <div class="notification" id="notification">
            New order received!
        </div>
    </div>

    <script>
        // === FIREBASE CONFIGURATION ===
        const firebaseConfig = {
            apiKey: "AIzaSyD4OzqErn78_CqQ_L8R0YPuZAzeug9WTz0",
            authDomain: "tropic-magic-stall.firebaseapp.com",
            projectId: "tropic-magic-stall",
            storageBucket: "tropic-magic-stall.firebasestorage.app",
            messagingSenderId: "763704245063",
            appId: "1:763704245063:web:ad7f52a42e44c609b82a62",
            measurementId: "G-3RPBC3PWVX"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        let orders = [];
        let bestSellers = {};

        // Real-time listener for orders
        db.collection('orders').orderBy('orderTime', 'desc')
            .onSnapshot((snapshot) => {
                orders = [];
                snapshot.forEach((doc) => {
                    orders.push(doc.data());
                });
                
                updateDashboard();
                
                // Show notification for new orders
                if (snapshot.docChanges().some(change => change.type === 'added')) {
                    showNotification('New order received!');
                }
            });

        function updateDashboard() {
            updateOrderColumns();
            updateStats();
            updateBestSellers();
        }

        function updateOrderColumns() {
            // Clear all columns
            document.getElementById('waitingColumn').innerHTML = '';
            document.getElementById('preparingColumn').innerHTML = '';
            document.getElementById('readyColumn').innerHTML = '';
            document.getElementById('completedColumn').innerHTML = '';

            const waitingOrders = orders.filter(o => o.status === 'waiting');
            const preparingOrders = orders.filter(o => o.status === 'preparing');
            const readyOrders = orders.filter(o => o.status === 'ready');
            const completedOrders = orders.filter(o => o.status === 'completed');

            // Add orders to waiting column
            if (waitingOrders.length === 0) {
                document.getElementById('waitingColumn').innerHTML = `
                    <div class="empty-state">
                        <div class="icon">‚è≥</div>
                        <p>No orders waiting</p>
                    </div>
                `;
            } else {
                waitingOrders.forEach(order => {
                    document.getElementById('waitingColumn').appendChild(createOrderCard(order));
                });
            }

            // Add orders to preparing column
            if (preparingOrders.length === 0) {
                document.getElementById('preparingColumn').innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üë®‚Äçüç≥</div>
                        <p>No orders preparing</p>
                    </div>
                `;
            } else {
                preparingOrders.forEach(order => {
                    document.getElementById('preparingColumn').appendChild(createOrderCard(order));
                });
            }

            // Add orders to ready column
            if (readyOrders.length === 0) {
                document.getElementById('readyColumn').innerHTML = `
                    <div class="empty-state">
                        <div class="icon">‚úÖ</div>
                        <p>No orders ready</p>
                    </div>
                `;
            } else {
                readyOrders.forEach(order => {
                    document.getElementById('readyColumn').appendChild(createOrderCard(order));
                });
            }

            // Add orders to completed column
            if (completedOrders.length === 0) {
                document.getElementById('completedColumn').innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üéâ</div>
                        <p>No orders completed</p>
                    </div>
                `;
            } else {
                completedOrders.forEach(order => {
                    document.getElementById('completedColumn').appendChild(createOrderCard(order));
                });
            }

            // Update column counts
            document.getElementById('waitingCount').textContent = `${waitingOrders.length} orders`;
            document.getElementById('preparingCount').textContent = `${preparingOrders.length} orders`;
            document.getElementById('readyCount').textContent = `${readyOrders.length} orders`;
            document.getElementById('completedCount').textContent = `${completedOrders.length} orders`;
        }

        function createOrderCard(order) {
            const card = document.createElement('div');
            card.className = `order-card ${order.status}`;
            
            const nextStatus = getNextStatus(order.status);
            const statusButtons = nextStatus.map(status => 
                `<button class="status-btn btn-${status}" onclick="updateOrderStatus('${order.id}', '${status}')">
                    ${status.charAt(0).toUpperCase() + status.slice(1)}
                </button>`
            ).join('');
            
            card.innerHTML = `
                <div class="order-id">${order.id}</div>
                <div class="customer-info">${order.customerName} ‚Ä¢ ${order.phone}</div>
                <div class="order-items">
                    ${order.items.map(item => `<p>‚Ä¢ ${item}</p>`).join('')}
                </div>
                <div class="order-total">‚Çπ${order.total}</div>
                <div class="order-time">${order.orderTime}</div>
                <div class="order-actions">
                    ${statusButtons}
                </div>
            `;
            return card;
        }

        function getNextStatus(currentStatus) {
            const statusFlow = {
                'waiting': ['preparing'],
                'preparing': ['ready', 'waiting'],
                'ready': ['completed', 'preparing'],
                'completed': []
            };
            return statusFlow[currentStatus] || [];
        }

        async function updateOrderStatus(orderId, newStatus) {
            try {
                await db.collection('orders').doc(orderId).update({
                    status: newStatus,
                    ...(newStatus === 'completed' && { completed: true })
                });
                showNotification(`Order ${orderId} moved to ${newStatus}`);
            } catch (error) {
                console.error('Error updating status:', error);
                alert('Failed to update status. Please try again.');
            }
        }

        function updateStats() {
            const totalOrders = orders.length;
            const waitingOrders = orders.filter(o => o.status === 'waiting').length;
            const preparingOrders = orders.filter(o => o.status === 'preparing').length;
            const revenue = orders.reduce((sum, order) => sum + order.total, 0);

            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('waitingOrders').textContent = waitingOrders;
            document.getElementById('preparingOrders').textContent = preparingOrders;
            document.getElementById('revenue').textContent = `‚Çπ${revenue}`;
        }

        function updateBestSellers() {
            // Calculate best sellers
            bestSellers = {};
            orders.forEach(order => {
                order.items.forEach(item => {
                    bestSellers[item] = (bestSellers[item] || 0) + 1;
                });
            });

            // Convert to array and sort
            const sortedSellers = Object.entries(bestSellers)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3);

            const bestSellersList = document.getElementById('bestSellersList');
            
            if (sortedSellers.length === 0) {
                bestSellersList.innerHTML = `
                    <div class="seller-item">
                        <span>No orders yet</span>
                        <span class="seller-count">-</span>
                    </div>
                `;
                return;
            }

            bestSellersList.innerHTML = sortedSellers.map(([item, count], index) => `
                <div class="seller-item">
                    <span><span class="seller-rank">${index + 1}.</span> ${item}</span>
                    <span class="seller-count">${count} orders</span>
                </div>
            `).join('');
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Initialize
        updateDashboard();
    </script>
</body>
</html>
